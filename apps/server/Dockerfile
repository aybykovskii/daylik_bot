FROM aybykovskii/daylik-base:latest

WORKDIR /app

COPY apps/server ./apps/server
RUN pnpm install --filter=server --frozen-lockfile

ENV NODE_ENV=production

ARG POSTGRES_HOST
ARG POSTGRES_PORT
ARG POSTGRES_USER
ARG POSTGRES_PASSWORD
ARG POSTGRES_DB
ARG SERVER_PORT=8080

ENV SERVER_PORT=${SERVER_PORT}
ENV POSTGRES_HOST=${POSTGRES_HOST}
ENV POSTGRES_PORT=${POSTGRES_PORT}
ENV POSTGRES_USER=${POSTGRES_USER}
ENV POSTGRES_PASSWORD=${POSTGRES_PASSWORD}
ENV POSTGRES_DB=${POSTGRES_DB}

EXPOSE ${SERVER_PORT}

CMD ["bun", "./apps/server/server.ts"]